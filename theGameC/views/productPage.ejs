<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>商品 - 商品單頁</title>
    <link rel="stylesheet" href="/style/style.css" />
    <link rel="stylesheet" href="/style/productPage.css" />
    <link rel="stylesheet" href="/style/comment.css" />
    <script type="text/javascript" src="/app/jquery.js"></script>
  </head>
  <body>
    <!-- header -->
    <%- include('share/header')%>

    <div class="<%= typeCss %>">
      <div class="ProductPage">
        <p class="productNav">
          TheGameC > 商店 > <span><%- productData.product_name%></span>
        </p>
        <!-- s1 商品介紹 -->
        <section class="section1">
          <img id="typeIcon" src="<%- typeIcon %>" alt="" />
          <div class="s1left">
            <div class="bigPicDiv">
              <img
                id="bigPic"
                src="/img/products/<%- productData.image%>"
                alt=""
              />
            </div>
          </div>
          <div class="s1right">
            <h2><%- productData.product_name%></h2>
            <div class="type"><span><%- productData.product_type%></span></div>
            <div>
              <p><%- productData.description%></p>
            </div>
            <div>
              <p>開發商：<span><%- productData.developer%></span></p>
              <p>營運商：<span><%- productData.publisher%></span></p>
              <p>年齡限制： <span><%- ageRating%></span></p>
            </div>
            <div>
              <p>評分：<span>5</span></p>
              <p>購買人數：<span><%- productData.buy_count%></span></p>
            </div>
            <div class="s1btnDiv">
              <span>價格：NT$ <span><%- productData.price %></span></span>
              <button>加入購物車</button>
            </div>
          </div>
        </section>

        <!-- s2 評論 -->
        <section class="section2">
          <h2>發表評論</h2>

          <% if (login_user_id){%>
          <!-- 已登入 -->
          <form id="formReview" class="commitLogin">
            <input
              id="productID"
              type="hidden"
              value="<%- productData.product_id%>"
            />
            <input id="userID" type="hidden" value="<%- login_user_id %>" />
            <div class="s2left">
              <div>
                <span>評分：</span
                ><span class="star-rating">
                  <input id="star1" type="radio" name="rating" value="1" />
                  <label for="star1" title="1 star" class="star"></label>
                  <input id="star2" type="radio" name="rating" value="2" />
                  <label for="star2" title="2 stars" class="star"></label>
                  <input id="star3" type="radio" name="rating" value="3" />
                  <label for="star3" title="3 stars" class="star"></label>
                  <input id="star4" type="radio" name="rating" value="4" />
                  <label for="star4" title="4 stars" class="star"></label>
                  <input id="star5" type="radio" name="rating" value="5" />
                  <label for="star5" title="5 stars" class="star"></label
                ></span>
              </div>
              <div>
                <span>您的評分：</span> <br />
                <div><span id="yourRating">?</span> <span>/5</span></div>
              </div>
              <div>
                <span>當前評分：</span><br />
                <div>
                  <span id="averageRating"><%- productRating %></span>
                  <span>/5</span>
                </div>
              </div>
            </div>
            <div class="s2right">
              <p>撰寫評論</p>
              <textarea name="comment" id="" cols="30" rows="10"></textarea>
              <div><button>張貼</button></div>
            </div>
          </form>
          <% } else {%>
          <!-- 未登入 -->
          <div class="commitNotLogin">
            <div>
              <span>登入您的帳號 向大家發表您的想法吧 ！</span>
              <a href="/login">登入</a>
            </div>
          </div>
          <%}%>
        </section>

        <!-- s3 推薦商品 -->
        <section class="section3">
          <h2>或許您也會喜歡</h2>
          <div class="recommendedProducts">
            <!-- 單個商品 -->
            <div class="recomProduct">
              <div class="recPImgDiv">
                <img src="/img/Products/simulation/Cities.jpg" alt="" />
              </div>
              <div class="recPInfo">
                <div class="recPtitle">
                  <h3>CSO 絕對武力</h3>
                  <div><span id="recPtype">射擊</span></div>
                </div>
                <div class="recPTextLimit">
                  <p>
                    《極地戰嚎5》是一款開放世界的第一人稱動作遊戲，玩家需要與異教勢力作戰，並自由探索世界、狩獵、駕駛車輛。<br />故事背景主要是以美國蒙大拿州當中一個名為希望郡的小鎮，受到末日教派的邪教團體紮根影響，下至人民日常生活用品製造、上至警方與政府單位，都已受其黨羽深度滲透，玩家扮演的則是一個小小的警察，隻身一人四處培植反抗勢力，以期有朝一日能絕地反攻的各種日常生活。
                  </p>
                </div>
              </div>
              <div class="recPgoPage"><a href="/">前往頁面</a></div>
            </div>
            <!-- 單個商品 -->
            <div class="recomProduct">
              <div class="recPImgDiv">
                <img src="/img/Products/simulation/Cities.jpg" alt="" />
              </div>
              <div class="recPInfo">
                <div class="recPtitle">
                  <h3>CSO 絕對武力</h3>
                  <div><span id="recPtype">射擊</span></div>
                </div>
                <div class="recPTextLimit">
                  <p>
                    Counter-Strike 是一款經典的第一人
                    稱射擊遊戲，玩家需要根據任務目標
                    進行射擊、燒毀物品、拆除炸彈等各
                    種戰鬥行動。遊戲以恐怖分子和反恐
                    精英兩方對戰為主題，具有深度和高
                    度的槍械操作性和社交性的遊戲。
                  </p>
                </div>
              </div>
              <div class="recPgoPage"><a href="/">前往頁面</a></div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- footer -->
    <%- include('share/footer')%>
    <script src="/app/app.js"></script>

    <script>
      /* 星星 */
      $("input[name=rating]").on("change", function () {
        var inputRating = $("input[name=rating]:checked").val();
        $("#yourRating").html(inputRating);
      });

      // var stars = document.getElementsByClassName("star");

      // for (var i = 0; i < stars.length; i++) {
      //   stars[i].addEventListener("click", function () {
      //     var rating = parseInt(this.previousElementSibling.value);

      //     // 移除所有星
      //     for (var j = 0; j < stars.length; j++) {
      //       stars[j].classList.remove("star_filled");
      //     }

      //     for (var k = 0; k < rating; k++) {
      //       stars[k].classList.add("star_filled");
      //     }
      //   });
      // }

      ////////////////////////////////////////////////////////////////
      ////////////////////////////////////////////////////////////////
      /* 上傳評論 */
      $(function () {
        const productId = $("#productID").val();
        const userId = $("#userID").val();

        $("#formReview").on("submit", function (e) {
          e.preventDefault();

          $.ajax({
            url: `http://localhost:80/products/api/insertPR/PID/${productId}`,
            type: "POST",
            data: {
              product_id: productId,
              user_id: userId,
              rating: $("input[name=rating]:checked").val(),
              comment: $("textarea[name=comment]").text(),
            },
          })
            .done((data) => {
              alert(`感謝您的支持！`);
            })
            .fail((jqXHR, textStatus, errorThrown) => {
              console.error("Error:", textStatus, errorThrown);
              alert("請稍後重試。");
            });
        });
      });
    </script>
  </body>
</html>
